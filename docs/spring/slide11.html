<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>分散分析</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/css/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/css/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/lib/font/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/accessibility/helper.css"/>

<link rel="stylesheet" href="./myconf.css"/>
<link rel="stylesheet" href="./reveal.js/lib/css/zenburn.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">分散分析</h1>
</div>
<div class="talk-subtitle">
    <p>複数のグループ間の違いを検証する</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  2020.07.03</p>
</div>

</section>

<section>
<section id="slide-org48cd5d5">
<h2 id="org48cd5d5">分散分析とは</h2>
<div class="outline-text-2" id="text-org48cd5d5">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgeb1962c">
<h3 id="orgeb1962c">分散分析</h3>
<ul>
<li>平均の差の検定: 
<b>2つのグループ間</b> で平均の差があるか否か</li>
<li>分散分析: 
<b>2つ以上のグループ間</b> で平均の差があるか否か</li>
<li><p>
仮説の例: 
</p>
<ul>
<li>ある小売店について「売上高は月によって差があるか」</li>
<li>ある銘柄の株価について「収益率は曜日によって差があるか」</li>

</ul>
<p>
という仮説を検定するのに分散分析は有用
</p></li>
<li>検定問題の一つ</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org6a5dbc9">
<h3 id="org6a5dbc9">基本的な考え方</h3>
<ul>
<li>データの変動を分解:
<ul>
<li>グループ間での変動</li>
<li>観測誤差のみに起因する変動</li>

</ul></li>
<li>変動の大きさを比較:
<ul>
<li>平均に差がない: 自由度を除いて両者に本質的な差がない</li>
<li>平均に差がある: グループ間の変動が増してより大きくなる</li>

</ul></li>
<li>分散分析は「データの変動の分析」 \\ (変動=不確定性)</li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgb016a03">
<h2 id="orgb016a03">分散の比の検定 (再掲)</h2>
<div class="outline-text-2" id="text-orgb016a03">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org2698780">
<h3 id="org2698780">分散の比の検定</h3>
<ul>
<li><p>
2種類のデータの分散が等しいか否かを検定する
</p>
<div>
\begin{equation}%\label{mean-equal}
  H_0:\sigma_1^2=\sigma_2^2\quad\text{vs}\quad H_1:\sigma_1^2\neq\sigma_2^2
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org0ae12fd">
<h3 id="org0ae12fd">考え方</h3>
<ul>
<li>\(X_1,\dotsc,X_m\) の不偏分散: \(s_1^2\)</li>
<li>\(Y_1,\dotsc,Y_n\) の不偏分散: \(s_2^2\)</li>
<li>このとき \(s_1^2,s_2^2\) は独立でそれぞれ
<ul>
<li>\((m{-}1)s_1^2/\sigma_1^2\)
自由度 \(m{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\((n{-}1)s_2^2/\sigma_2^2\)
は自由度 \(n{-}1\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li><p>
検定統計量:
</p>
<div>
\begin{equation}
  F=s_1^2/s_2^2
\end{equation}

</div></li>
<li>帰無仮説 \(H_0\) が正しいならば
\(F\) は自由度 \(m{-}1,n{-}1\) の \(F\) 分布に従う</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org3581df4">
<h3 id="org3581df4">棄却域の取り方</h3>
<ul>
<li>有意水準: \(\alpha\in(0,1)\)</li>
<li>自由度 \(m{-}1,n{-}1\) の \(F\) 分布の
\(\alpha/2,\,1{-}\alpha/2\) 分位点:
\(F_{\alpha/2}(m{-}1,n{-}1)\),
\(F_{1{-}\alpha/2}(m{-}1,n{-}1)\)</li>
<li><p>
\(H_0\) の下では以下が成立:
</p>
<div>
\begin{equation}
  P(F < F_{\alpha/2}(m{-}1,n{-}1)
  \text{ または }F > F_{1{-}\alpha/2}(m{-}1,n{-}1))=\alpha
\end{equation}

</div></li>
<li><p>
第一種過誤の上限が \(\alpha\) の棄却域:
</p>
<div>
\begin{equation}
  R_{\alpha}=
  \left(-\infty,F_{\alpha/2}(m{-}1,n{-}1)\right)
  \cup\left(F_{1{-}\alpha/2}(m{-}1,n{-}1),\infty\right)
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org0f976b2">
<h3 id="org0f976b2">検定の手順 (棄却域を用いる場合)</h3>
<ul>
<li>データから検定統計量 \(F\) の値を計算</li>
<li><p>
以下の場合，帰無仮説を棄却
</p>
<div>
\begin{equation}
  F < F_{\alpha/2}(m{-}1,n{-}1)
  \text{ または }F>F_{1{-}\alpha/2}(m{-}1,n{-}1)
\end{equation}

</div></li>
<li>\(p\) 値の計算や片側対立仮説への対応方法は前と同様</li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orgcd4d886">
<h2 id="orgcd4d886">一元配置</h2>
<div class="outline-text-2" id="text-orgcd4d886">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgcfb9701">
<h3 id="orgcfb9701">一元配置の問題設定</h3>
<ul>
<li>グループ分けが1種類の場合</li>
<li>\(p\) 個のグループ \(A_1,A_2,\dotsc,A_p\) を想定</li>
<li><p>
各グループ \(i\) ごとに \(n_i\) 個のデータを観測
</p>
<div>
\begin{equation}
  Y_{i1},Y_{i2},\dotsc,Y_{in_i},\quad (i=1,2,\dotsc,p)
\end{equation}

</div></li>
<li>例: 小売店の売上高の問題
<ul>
<li>\(A_1,A_2,\dotsc,A_p\): 月</li>
<li>\(Y_{i1},Y_{i2},\dotsc,Y_{in_i}\): \(i\) 月の各日における売上高</li>

</ul></li>
<li>分散分析の用語:
<ul>
<li><b>因子</b>: グループ分けのこと (月ごと)</li>
<li><b>水準</b>: 因子内の各グループのこと (1月，2月，3月，…)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgde4f1d7">
<h3 id="orgde4f1d7">一元配置のモデル</h3>
<ul>
<li><p>
観測データのモデル:
</p>
<div>
\begin{equation}\label{one-way}
  Y_{ij}=\mu_i+\varepsilon_{ij}\quad(i=1,\dotsc,p;\;j=1,\dotsc,n_i).
\end{equation}

</div></li>
<li>モデルの仮定:
<ul>
<li>水準 \(A_i\) における観測データの平均値 \(\mu_i\) は定数</li>
<li>\(\varepsilon_{ij}\) は独立同分布(平均0, 分散 \(\sigma^2\) の正規分布)</li>

</ul></li>
<li><p>
各水準 \(A_1,A_2,\dotsc,A_p\) の平均値に差があるか否かを検定する問題:
</p>
<div>
\begin{equation}
  H_0:\mu_1=\cdots=\mu_p\quad\text{vs}\quad
  H_1:\text{ある$i,j$に対して}\mu_i\neq\mu_j.
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd0c764d">
<h3 id="orgd0c764d">分析の考え方</h3>
<ul>
<li>データの変動から因子間での変動と観測誤差の変動を抽出して比較</li>
<li><p>
各種平均: (\(n=\sum_{i=1}^pn_i\) は全サンプル数)
</p>
<div>
\begin{align}
  &\text{(全データの標本平均)}
  &\bar{Y}_{\cdot\cdot}&=\frac{1}{n}\sum_{i=1}^p\sum_{j=1}^{n_i}Y_{ij},\\
  &\text{(水準$A_i$の標本平均)}
  &\bar{Y}_{i\cdot}&=\frac{1}{n_i}\sum_{j=1}^{n_i}Y_{ij}\quad
  (i=1,\dotsc,p).
\end{align}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org67ab8e0">
<h3 id="org67ab8e0">分析の考え方 (つづき)</h3>
<ul>
<li><p>
各種変動:
</p>
<div>
\begin{align}
  &\text{(全変動)}
  &SS_T&=\sum_{i=1}^p\sum_{j=1}^{n_i}(Y_{ij}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(級内変動)}
  &SS_W&=\sum_{i=1}^p\sum_{j=1}^{n_i}(Y_{ij}-\bar{Y}_{i\cdot})^2,\\
  &\text{(級間変動)}
  &SS_B&=\sum_{i=1}^p\sum_{j=1}^{n_i}(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2
  =\sum_{i=1}^pn_i(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2.
\end{align}

</div>
<ul>
<li><b>級内変動</b>: 各水準内でのデータの変動 (観測誤差に起因)</li>
<li><b>級間変動</b>: 水準間でのデータの変動</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgbb0a47e">
<h3 id="orgbb0a47e">分析の考え方 (つづき)</h3>
<ul>
<li><p>
変動の分解:
</p>
<div>
\begin{equation}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }n{-}1}
  =\underbrace{\text{(級内変動) }SS_W}_{\text{自由度 }n{-}p}
  +\underbrace{\text{(級間変動) }SS_B}_{\text{自由度 }p{-}1}
\end{equation}

</div></li>
<li>帰無仮説 \(H_0\) が正しい:
<ul>
<li>水準内・水準間でのデータの変動はともに観測誤差が原因</li>
<li>自由度を除けば本質的な違いはない</li>
<li>\(SS_W/(n{-}p)\), \(SS_B/(p{-}1)\) はともに \(\sigma^2\) の不偏推定量</li>

</ul></li>
<li>対立仮説 \(H_1\) が正しい:
<ul>
<li>水準間での変動は観測誤差と平均値の差に影響される</li>
<li>\(SS_B\) は \(SS_W\) より本質的に大きくなる</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org5a61345">
<h3 id="org5a61345">一元配置の検定</h3>
<ul>
<li><p>
検定統計量:
</p>
<div>
\begin{equation}
  F=\frac{SS_B/(p{-}1)}{SS_W/(n{-}p)}
\end{equation}

</div></li>
<li>帰無仮説の下で次の事実が成り立つ:
<ul>
<li>\(SS_B,SS_W\) は独立</li>
<li>\(SS_B\) は自由度 \(p{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\(SS_W\) は自由度 \(n{-}p\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li>帰無仮説の下 \(F\) は自由度 \(p{-}1,n{-}p\) の \(F\) 分布に従う</li>
<li>対立仮説の下 \(F\) は大きな値をとるので右片側検定</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org58bc1b9">
<h3 id="org58bc1b9">棄却域の取り方</h3>
<ul>
<li>有意水準: \(\alpha\in(0,1)\)</li>
<li>自由度 \(p{-}1,n{-}p\) の \(F\) 分布の \(1{-}\alpha\) 分位点:
\(F_{1{-}\alpha}(p{-}1,n{-}p)\)</li>
<li><p>
\(H_0\) の下で以下が成立:
</p>
<div>
\begin{equation}
  P(F>F_{1{-}\alpha}(p{-}1,n{-}p))=\alpha
\end{equation}

</div></li>
<li><p>
第一種過誤の上限が \(\alpha\) となる棄却域:
</p>
<div>
\begin{equation}
  \left(F_{1{-}\alpha}(p{-}1,n{-}p),\infty\right)
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc932e9b">
<h3 id="orgc932e9b">検定の手順</h3>
<ul>
<li>データから検定統計量 \(F\) の値を計算</li>
<li><p>
棄却域を用いる方法: 以下の場合，帰無仮説を棄却
</p>
<div>
\begin{equation}
  F>F_{1{-}\alpha}(p{-}1,n{-}p)
\end{equation}

</div></li>
<li><p>
\(p\) 値を用いる方法: \(p\) 値を計算
</p>
<div>
\begin{equation}
  \text{$p$値}=\int_{F}^\infty f(x)dx
\end{equation}

</div>
<p>
(\(f(x)\) は自由度 \(p{-}1,n{-}p\) の \(F\) 分布の密度) <br />
\(p\) 値が \(\alpha\) 未満なら帰無仮説を棄却
</p></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org8016b11">
<h3 id="org8016b11">分散分析表 (一元配置の場合)</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">自由度</th>
<th scope="col" class="org-left">平方和</th>
<th scope="col" class="org-left">平均平方和</th>
<th scope="col" class="org-left">\(F\) 値</th>
<th scope="col" class="org-left">\(p\) 値</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">級間</td>
<td class="org-left">\(p{-}1\)</td>
<td class="org-left">\(SS_B\)</td>
<td class="org-left">\(SS_B/(p{-}1)\)</td>
<td class="org-left">\(F\)</td>
<td class="org-left">\(\mathstrut\int_{F}^\infty f(x)dx\)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">級内</td>
<td class="org-left">\(n{-}p\)</td>
<td class="org-left">\(SS_W\)</td>
<td class="org-left">\(SS_W/(n{-}p)\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">全変動</td>
<td class="org-left">\(n{-}1\)</td>
<td class="org-left">\(SS_T\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org3cf6192">
<h3 id="org3cf6192">モデルの別表現</h3>
<p>
各水準の平均値の相対効果による定式化:
</p>
<ul>
<li>因子 \(A\) 全体の平均効果: \(\mu\)</li>
<li>平均 \(\mu\) を基準とした各水準 \(A_i\) の相対的な効果: \(\alpha_i\)</li>
<li><p>
平均値の別表現:
</p>
<div>
\begin{equation}
  \mu_i=\mu+\alpha_i,\quad
  \mu=\frac{1}{n}\sum_{i=1}^pn_i\mu_i,\quad
  \sum_{i=1}^pn_i\alpha_i=0
\end{equation}

</div></li>
<li><p>
帰無仮説 \(H_0\) は以下と同等:
</p>
<div>
\begin{equation}
  \alpha_1=\cdots=\alpha_p=0
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org20489d7" data-background="#fef4f4">
<h3 id="org20489d7">演習</h3>
<ul>
<li><code>anova-oneway.r</code> を確認しなさい．</li>
<li>自身で収集したデータについて，
一元配置の問題を考えてみなさい．</li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org231b723">
<h2 id="org231b723">二元配置</h2>
<div class="outline-text-2" id="text-org231b723">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgadd5fa7">
<h3 id="orgadd5fa7">二元配置の問題</h3>
<ul>
<li>因子が2種類ある場合</li>
<li>一方の因子の水準の平均値に差があるか否かを検定</li>
<li>もう一方の因子の水準で平均値に差があるかは不問</li>
<li>例: 複数の薬の効能を複数の被験者に投与する治験
<ul>
<li>「薬の種類」と「被験者番号」の2種類の因子</li>
<li>「薬の種類」という因子での薬の効能の差を検証したい</li>
<li>「被験者番号」という因子で効能に差があることは許容したい
(薬の効き目には個人差があると考えられるため)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org6c7a48d">
<h3 id="org6c7a48d">二元配置のモデル</h3>
<ul>
<li>2種類の因子 \(A, B\)
<ul>
<li>因子 \(A\) には \(a\) 個の水準: \(A_1,\dotsc,A_a\)</li>
<li>因子 \(B\) には \(b\) 個の水準: \(B_1,\dotsc,B_b\)</li>
<li>因子 \(A,B\) の水準がそれぞれ \(A_i,B_j\) である観測値: \(Y_{ij}\)</li>

</ul></li>
<li><p>
観測データのモデル:
</p>
<div>
\begin{equation}\label{two-way}
  Y_{ij}=\alpha_i+\beta_j+\varepsilon_{ij}\quad
  (i=1,\dotsc,a;\;j=1,\dotsc,b).
\end{equation}

</div></li>
<li>モデルの仮定:
<ul>
<li>\(\alpha_i,\beta_j\) は定数，それぞれ因子 \(A,B\) の水準 \(A_i,B_j\) における効果</li>
<li>\(\varepsilon_{ij}\) は独立同分布 (平均0, 分散 \(\sigma^2\) の正規分布)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd27192f">
<h3 id="orgd27192f">二元配置の例</h3>
<ul>
<li>例: 複数の薬の治験の問題
<ul>
<li>因子 \(A\): 「薬の種類」/ 因子 \(B\): 「被験者番号」</li>
<li>\(\alpha_i\): 薬 \(A_i\) の効能 / \(\beta_j\): 被験者 \(B_j\) 固有の薬の効きやすさ</li>
<li>薬の効能に差があるか否かという検定</li>

</ul></li>
<li><p>
因子 \(A\) の各水準の効果に差があるか否かを検定する問題:
</p>
<div>
\begin{equation}
  H_0:\alpha_1=\cdots=\alpha_a\quad\text{vs}\quad
  H_1:\text{ある$i_1,i_2$に対して}\alpha_{i_1}\neq\alpha_{i_2}.
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org3ee4a06">
<h3 id="org3ee4a06">分析の考え方</h3>
<ul>
<li>データの変動から因子間での変動と観測誤差の変動を抽出して比較</li>
<li><p>
各種平均:
</p>
<div>
\begin{align}
  &\text{(全データの標本平均)}
  &\bar{Y}_{\cdot\cdot}&=\frac{1}{n}\sum_{i=1}^p\sum_{j=1}^{n_i}Y_{ij},\\
  &\text{(水準$A_i$の標本平均)}
  &\bar{Y}_{i\cdot}&=\frac{1}{b}\sum_{j=1}^bY_{ij}\quad
                     (i=1,\dotsc,a),\\
  &\text{(水準$B_j$の標本平均)}
  &\bar{Y}_{\cdot j}&=\frac{1}{a}\sum_{i=1}^aY_{ij}\quad
                      (j=1,\dotsc,b).
\end{align}

</div>
<p>
ただし \(n=ab\)
</p></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org2ec608d">
<h3 id="org2ec608d">分析の考え方 (つづき)</h3>
<ul>
<li><p>
因子効果の推定量としての標本平均:
</p>
<div>
\begin{align}
  \bar{Y}_{i\cdot}
  &\to\alpha_i+\frac{1}{b}\sum_{j=1}^b\beta_j,\\
  \bar{Y}_{\cdot j}
  &\to\frac{1}{a}\sum_{i=1}^a\alpha_i+\beta_j,\\
  \bar{Y}_{\cdot\cdot}
  &\to\frac{1}{ab}\sum_{i=1}^a\sum_{j=1}^b(\alpha_i+\beta_j)=\frac{1}{a}\sum_{i=1}^a\alpha_i+\frac{1}{b}\sum_{j=1}^b\beta_j
\end{align}

</div>
<div>
\begin{equation}
  Y_{ij}-\bar{Y}_{i\cdot}
  -\bar{Y}_{\cdot j}+\bar{Y}_{\cdot\cdot}
  \to\varepsilon_{ij}
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org2b322eb">
<h3 id="org2b322eb">分析の考え方 (つづき)</h3>
<ul>
<li><p>
各種変動:
</p>
<div>
\begin{align}
  &\text{(行間変動)}
  &SS_A&=b\sum_{i=1}^a(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(列間変動)}
  &SS_B&=a\sum_{j=1}^b(\bar{Y}_{\cdot j}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(誤差変動)}
  &SS_E&=\sum_{i=1}^a\sum_{j=1}^b(Y_{ij}-\bar{Y}_{i\cdot}
         -\bar{Y}_{\cdot j}+\bar{Y}_{\cdot\cdot})^2.
\end{align}

</div>
<ul>
<li><b>行間変動</b>: 水準 \(A\) 内でのデータの変動</li>
<li><b>列間変動</b>: 水準 \(B\) 内でのデータの変動</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgf67f44c">
<h3 id="orgf67f44c">分析の考え方 (つづき)</h3>
<ul>
<li><p>
変動の分解:
</p>
<div>
\begin{multline}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }ab-1}
  =\underbrace{\text{(行間変動) }SS_A}_{\text{自由度 }a-1}\\
  +\underbrace{\text{(列間変動) }SS_B}_{\text{自由度 }b-1}
  +\underbrace{\text{(誤差変動) }SS_B}_{\text{自由度 }(a-1)(b-1)}
\end{multline}

</div></li>
<li>帰無仮説 \(H_0\) が正しい:
<ul>
<li>変動 \(SS_A,SS_E\) はともに観測誤差のみが原因で生じる</li>
<li>自由度を除けば本質的な違いはない</li>
<li>\(SS_A/(a{-}1)\), \(SS_E/\{(a{-}1)(b{-}1)\}\) は \(\sigma^2\) の不偏推定量</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgaa24f3c">
<h3 id="orgaa24f3c">分析の考え方 (つづき)</h3>
<ul>
<li><p>
変動の分解:
</p>
<div>
\begin{multline}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }ab-1}
  =\underbrace{\text{(行間変動) }SS_A}_{\text{自由度 }a-1}\\
  +\underbrace{\text{(列間変動) }SS_B}_{\text{自由度 }b-1}
  +\underbrace{\text{(誤差変動) }SS_B}_{\text{自由度 }(a-1)(b-1)}
\end{multline}

</div></li>
<li>対立仮説 \(H_1\) が正しい:
<ul>
<li>因子 \(A\) 内の水準間での効果 \(\alpha_1,\dotsc,\alpha_a\) の差に影響される</li>
<li>\(SS_A\) は \(SS_E\) より本質的に大きくなる</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org3118e92">
<h3 id="org3118e92">二元配置の検定</h3>
<ul>
<li><p>
検定統計量:
</p>
<div>
\begin{equation}
  F_A=\frac{SS_A/(a{-}1)}{SS_E/\{(a{-}1)(b{-}1)\}}
\end{equation}

</div></li>
<li>帰無仮説の下で次の事実が成り立つ:
<ul>
<li>\(SS_A,SS_E\) は独立</li>
<li>\(SS_A\) は自由度 \(a{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\(SS_E\) は自由度 \((a{-}1)(b{-}1)\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li>帰無仮説の下 \(F_A\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布に従う</li>
<li>対立仮説の下 \(F_A\) は大きな値をとるので右片側検定</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org4645366">
<h3 id="org4645366">棄却域の取り方</h3>
<ul>
<li>有意水準: \(\alpha\in(0,1)\)</li>
<li>自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布の \(1{-}\alpha\) 分位点:
\(F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1))\)</li>
<li><p>
\(H_0\) の下で以下が成立:
</p>
<div>
\begin{equation}
  P(F_A>F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1)))=\alpha
\end{equation}

</div></li>
<li><p>
第一種過誤の上限が \(\alpha\) となる棄却域:
</p>
<div>
\begin{equation}
  (F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1)),\infty)
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgcdd46bd">
<h3 id="orgcdd46bd">検定の手順</h3>
<ul>
<li>データから検定統計量 \(F_A\) の値を計算</li>
<li><p>
棄却域を使う方法: 以下の場合，帰無仮説を棄却
</p>
<div>
\begin{equation}
  F_A>F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1))
\end{equation}

</div></li>
<li><p>
\(p\) 値を使う方法: \(p\) 値を計算
</p>
<div>
\begin{equation}
  \text{($p$値)}=\int_{F_A}^\infty f_{a{-}1,(a{-}1)(b{-}1)}(x)dx
\end{equation}

</div>
<p>
(\(f\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布の確率密度関数)<br />
\(p\) 値が \(\alpha\) 未満なら帰無仮説を棄却
</p></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org7d2fbd9">
<h3 id="org7d2fbd9">分散分析表 (二配置の場合)</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">自由度</th>
<th scope="col" class="org-left">平方和</th>
<th scope="col" class="org-left">平均平方和</th>
<th scope="col" class="org-left">\(F\text{値}\)</th>
<th scope="col" class="org-left">\(p\text{値}\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(\text{因子}A\)</td>
<td class="org-left">\(a{-}1\)</td>
<td class="org-left">\(SS_A\)</td>
<td class="org-left">\(\displaystyle\frac{SS_A}{a{-}1}\)</td>
<td class="org-left">\(F_A\)</td>
<td class="org-left">\(\displaystyle\int_{F_A}^\infty f_{a{-}1,(a{-}1)(b{-}1)}(x)dx\)</td>
</tr>

<tr>
<td class="org-left">\(\text{因子}B\)</td>
<td class="org-left">\(b{-}1\)</td>
<td class="org-left">\(SS_B\)</td>
<td class="org-left">\(\displaystyle\frac{SS_B}{b{-}1}\)</td>
<td class="org-left">\(F_B\)</td>
<td class="org-left">\(\displaystyle\int_{F_B}^\infty f_{b{-}1,(a{-}1)(b{-}1)}(x)dx\)</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">\(\text{誤差}\)</td>
<td class="org-left">\((a{-}1)(b{-}1)\)</td>
<td class="org-left">\(SS_E\)</td>
<td class="org-left">\(\displaystyle\frac{SS_E}{(a{-}1)(b{-}1)}\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgee52d39">
<h3 id="orgee52d39">モデルの別表現</h3>
<p>
相対効果による定式化:
</p>
<ul>
<li><p>
モデルの書き換え:
</p>
<div>
\begin{align}
  \mu^*&=\bar{\alpha}+\bar{\beta},&
  \alpha^*_i&=\alpha_i-\bar{\alpha},&
  \beta^*_j&=\beta_j-\bar{\beta}\\
       &&\bar{\alpha}&=\frac{1}{a}\sum_{i=1}^a\alpha_i,
            &\bar{\beta}&=\frac{1}{b}\sum_{j=1}^b\beta_j
\end{align}

</div>
<div>
\begin{equation}
  Y_{ij}=\mu^*+\alpha^*_i+\beta^*_j+\varepsilon_{ij}\quad
  (i=1,\dotsc,a;\;j=1,\dotsc,b)
\end{equation}

</div>
<div>
\begin{equation}
  \text{ただし }\sum_{i=1}^a\alpha^*_i=\sum_{j=1}^b\beta^*_j=0
\end{equation}

</div></li>
<li><p>
帰無仮説 \(H_0\) は以下と同等:
</p>
<div>
\begin{equation}
  \alpha^*_1=\cdots=\alpha^*_a=0
\end{equation}

</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org048c134" data-background="#fef4f4">
<h3 id="org048c134">演習</h3>
<ul>
<li><code>anova-twoway.r</code> を確認しなさい．</li>
<li>自身で収集したデータについて，
二元配置の問題を考えてみなさい．</li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
</div>
</div>
<script src="./reveal.js/lib/js/head.min.js"></script>
<script src="./reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: true,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,

overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'fade', // see README of reveal.js for options
transitionSpeed: 'default',

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/audio-slideshow/audio-slideshow.js', condition: function( ) { return !!document.body.classList && !Reveal.isSpeakerNotes(); } },
{ src: './reveal.js/plugin/anything/anything.js' },
{ src: './reveal.js/plugin/toc-progress/toc-progress.js', async: true, callback: function() { toc_progress.initialize('reduce', 'rgba(120,138,130,0.2)'); toc_progress.create(); } },
{ src: './reveal.js/plugin/jump/jump.js', async: true },
{ src: './reveal.js/plugin/quiz/js/quiz.js', async: true, callback: function() { prepareQuizzes({preventUnanswered: true, skipStartButton: true}); } },
{ src: './reveal.js/plugin/coursemod/coursemod.js', async: true },
{ src: './reveal.js/plugin/accessibility/helper.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }]

,audioStartAtFragment: true,
  audio: {
    advance: -1, autoplay: false, defaultDuration: 0, defaultAudios: false, playerOpacity: 0.8, playerStyle: 'position: fixed; bottom: 9.5vh; left: 0%; width: 30%; height:30px; z-index: 33;' },
anything: [
        // Following initialization code for class animate from anything-demo.html.
        // Copyright (c) 2016 Asvin Goel, under The MIT License (MIT).
	{className: "animate",  initialize: (function(container, options){
		Reveal.addEventListener( 'fragmentshown', function( event ) {
			if (typeof event.fragment.beginElement === "function" ) {
				event.fragment.beginElement();
			}
		});
		Reveal.addEventListener( 'fragmenthidden', function( event ) {
			if (event.fragment.hasAttribute('data-reverse') ) {
				var reverse = event.fragment.parentElement.querySelector('[id=\"' + event.fragment.getAttribute('data-reverse') + '\"]');
				if ( reverse && typeof reverse.beginElement === "function" ) {
					reverse.beginElement();
				}
			}
		});
		if ( container.getAttribute("data-svg-src") ) {
			var xhr = new XMLHttpRequest();
			xhr.onload = function() {
				if (xhr.readyState === 4) {
					var svg = container.querySelector('svg');
					container.removeChild( svg );
					container.innerHTML = xhr.responseText + container.innerHTML;
					if ( svg ) {
						container.querySelector('svg').innerHTML = container.querySelector('svg').innerHTML + svg.innerHTML;
					}
				}
				else {
					console.warn( "Failed to get file. ReadyState: " + xhr.readyState + ", Status: " + xhr.status);
				}
			};
			xhr.open( 'GET', container.getAttribute("data-svg-src"), true );
			xhr.send();
		}
	}) },
	{className: "randomPic",
	 defaults: {imgalt: "Dummy alt text",
		    imgcaption: "Image by {name}",
		    choices: [ {name: "dummyname", path: "dummypath"} ]},
	 initialize: (function(container, options){
	     var choice = Math.trunc( Math.random()*(options.choices.length) );
	     var img = "<img src='" + options.choices[choice].path + "' alt='" + options.choices[choice].imgalt + "' />";
	     var caption = options.imgcaption.replace(new RegExp('\{name\}', 'gm'), options.choices[choice].name);
	     container.innerHTML = img + caption;
	 }) },
	{className: "notes",
	 initialize: (function(container, options){
	     container.addEventListener('click', function(e) { RevealNotes.open(); });
	 }) }
],
coursemod: { enabled: true, shown: false },
});
</script>
</body>
</html>
