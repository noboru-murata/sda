<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>データの整理と集計</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/css/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/css/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/lib/font/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./myconf.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body prefix="dc: http://purl.org/dc/elements/1.1/ dcterms: http://purl.org/dc/terms/ dcmitype: http://purl.org/dc/dcmitype/ cc: http://creativecommons.org/ns#" typeof="dcmitype:InteractiveResource">
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">データの整理と集計</h1>
</div>
<div class="talk-subtitle">
    <p></p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>

<section>
<section id="slide-orgee9061f">
<h2 id="orgee9061f">データフレームの基本操作</h2>
<div class="outline-text-2" id="text-orgee9061f">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd549ad7">
<h3 id="orgd549ad7">Rに用意されているデータ構造 (再掲)</h3>
<p>
下記は代表的なもので，これ以外にもある
</p>
<ul>
<li>ベクトル (vector)</li>
<li>行列 (matrix)</li>
<li>リスト (list)</li>
<li><b>データフレーム (data frame)</b></li>
<li>配列 (array)</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org2d120bd">
<h3 id="org2d120bd">データフレームからの項目の抽出</h3>
<ul>
<li>添字の番号を指定</li>
<li>要素の名前で指定</li>
<li><b>除外</b>: マイナス記号(-)をつけて指定</li>
<li>論理値で指定
<ul>
<li><code>TRUE</code>: 要素の選択</li>
<li><code>FALSE</code>: 要素の <b>除外</b></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org7a985ea">
<h4 id="org7a985ea">例: <code>data-select.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#26465;&#20214;&#12395;&#21512;&#33268;&#12377;&#12427;&#34892;&#12398;&#36984;&#25246;</span>
which(airquality$Ozone&gt;100 &amp; airquality$Wind&lt;=5) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#35079;&#25968;&#12398;&#26465;&#20214;&#12398; AND</span>
which(with(airquality, Ozone&gt;100 &amp; Wind&lt;=5))     <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19978;&#12392;&#21516;&#12376; (&#12362;&#34214;&#12417;&#12398;&#30701;&#12356;&#26360;&#12365;&#26041;)</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">airquality$Ozone&gt;100 &amp; airquality$Wind&lt;=5 # (NA&#12399;NA&#12392;&#12394;&#12427;&#12371;&#12392;&#12395;&#27880;&#24847;)</span>

<span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#34892;&#12398;&#25277;&#20986;</span>
airquality[which(with(airquality, Ozone&gt;100 &amp; Wind&lt;=5)), ] 
<span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#21015;&#12398;&#25277;&#20986;</span>
airquality[which(with(airquality, Ozone&gt;100 &amp; Wind&lt;=5)), c(<span style="color: #f1fa8c;">"Month"</span>,<span style="color: #f1fa8c;">"Day"</span>)] 
</pre>
</div>

<pre class="example">
[1]  62  99 117 121
[1]  62  99 117 121
    Ozone Solar.R Wind Temp Month Day
62    135     269  4.1   84     7   1
99    122     255  4.0   89     8   7
117   168     238  3.4   81     8  25
121   118     225  2.3   94     8  29
    Month Day
62      7   1
99      8   7
117     8  25
121     8  29
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org5a087d2">
<h4 id="org5a087d2">関数 <code>subset()</code></h4>
<p>
複合的な条件を指定してデータを整理する
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre  class="src src-R">subset(x,subset,select,drop=<span style="color: #61bfff;">FALSE</span>)
</pre>
</div></li>
<li>関数の引数
<ul>
<li><code>x</code>:  データフレーム</li>
<li><code>subset</code>: 行に関する条件</li>
<li><code>select</code>: 列に関する条件(未指定の場合は全ての列)</li>
<li><code>drop</code>: 結果が1行または1列の場合ベクトルとする(TRUE)かデータフレームとする(FALSE)か</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org83e1eb1">
<h4 id="org83e1eb1">例: <code>data-subset.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">### </span><span style="color: #6272a4;">Ozone&#12364;120&#12434;&#36229;&#12360;&#12427;&#34892;&#12391;&#29305;&#23450;&#12398;&#21015;(Wind&#12392;Day)&#12398;&#12487;&#12540;&#12479;</span>
subset(airquality, Ozone&gt;120, select=c(Wind,Day)) <span style="color: #6272a4;"># </span>
<span style="color: #6272a4;">### </span><span style="color: #6272a4;">Ozone&#12395;&#27424;&#28204;(NA)&#12364;&#12394;&#12367;, &#12363;&#12388;(AND)Day&#12364;5&#12363;10&#12391;Wind&#12363;&#12425;Day&#12414;&#12391;&#12398;&#21015;&#12398;&#12487;&#12540;&#12479;</span>
subset(airquality, !is.na(Ozone) &amp; Day <span style="color: #8be9fd;">%in%</span> c(5,10),select=Wind:Day)
<span style="color: #6272a4;">### </span><span style="color: #6272a4;">Ozone&#12364;120&#20197;&#19978;&#12363;&#65292;&#12414;&#12383;&#12399;Wind&#12364;3&#20197;&#19979;(OR)&#12391;Temp&#20197;&#22806;&#12398;&#21015;&#12434;&#25277;&#20986;</span>
subset(airquality, Ozone&gt;120 | Wind &lt;= 3, select = -Temp)
</pre>
</div>

<pre class="example">
    Wind Day
62   4.1   1
99   4.0   7
117  3.4  25
    Wind Temp Month Day
41  11.5   87     6  10
66   4.6   83     7   5
71   7.4   89     7  10
97   7.4   85     8   5
128  7.4   87     9   5
133  9.7   73     9  10
    Ozone Solar.R Wind Month Day
53     NA      59  1.7     6  22
62    135     269  4.1     7   1
99    122     255  4.0     8   7
117   168     238  3.4     8  25
121   118     225  2.3     8  29
126    73     183  2.8     9   3
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org030c9cd" data-background="#fef4f4">
<h3 id="org030c9cd">演習</h3>
<ul>
<li><code>datasets::airquality</code> に対して
以下の条件を満たすデータを取り出しなさい．
<ul>
<li>7月のオゾン濃度 (<code>Ozone</code>)</li>
<li>風速 (<code>Wind</code>) が時速10マイル以上で，
かつ気温 (<code>Temp</code>) が華氏80度以上の日のデータ</li>
<li>日射量 (<code>Solar.R</code>) が欠測 (<code>NA</code>) でないデータの
月 (<code>Month</code>) と日 (<code>Day</code>)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-orga9ae632">
<h2 id="orga9ae632">データファイルの取り扱い</h2>
<div class="outline-text-2" id="text-orga9ae632">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org7358cd6">
<h3 id="org7358cd6">データファイルの読み書き</h3>
<ul>
<li>実際の解析においては以下の操作が必要
<ul>
<li>収集されたデータを読み込む</li>
<li>整理したデータを保存する</li>

</ul></li>
<li>Rで利用可能なデータファイル
<ul>
<li>CSV形式(comma separated values): テキストファイル</li>
<li>RData形式: Rの内部表現を用いたバイナリーファイル</li>

</ul></li>
<li>データフレームを対象としたファイルの扱いをまとめる</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orga200924">
<h3 id="orga200924">作業ディレクトリ</h3>
<ul>
<li>Rは特定のフォルダ(<b>作業ディレクトリ</b>)で実行される</li>
<li>ファイルは作業ディレクトリに存在するものとして扱われる<br>
それ以外のファイルを扱う場合はパスを含めて指定する</li>
<li>作業ディレクトリの確認の仕方
<ul>
<li>コンソールの上部の表示</li>
<li>関数 <code>getwd()</code></li>

</ul></li>
<li>作業ディレクトリの変更の仕方
<ul>
<li>&ldquo;Session&rdquo;&gt;&ldquo;Set Working Directory&rdquo;&gt;&ldquo;Choose Directory&#x2026;&rdquo;</li>
<li>関数 <code>setwd()</code></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org6e5d559">
<h4 id="org6e5d559">例: <code>data-wd.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#20316;&#26989;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#30906;&#35469; (&#29872;&#22659;&#12395;&#12424;&#12387;&#12390;&#23455;&#34892;&#32080;&#26524;&#12364;&#30064;&#12394;&#12427;)</span>
getwd()
<span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#20316;&#26989;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#31227;&#21205; (&#29872;&#22659;&#12395;&#12424;&#12387;&#12390;&#25351;&#23450;&#12398;&#20181;&#26041;&#12418;&#30064;&#12394;&#12427;)</span>
<span style="color: #8be9fd;">setwd</span>(<span style="color: #f1fa8c;">"~/Documents"</span>) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#12507;&#12540;&#12512;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#19979;&#12398;&#12300;&#26360;&#39006;&#12301;&#12501;&#12457;&#12523;&#12480;&#12395;&#31227;&#21205;</span>
</pre>
</div>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc2611dd">
<h3 id="orgc2611dd">CSV形式の操作</h3>
<div class="outline-text-3" id="text-orgc2611dd">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org5b4a19f">
<h4 id="org5b4a19f">関数 <code>write.csv()</code></h4>
<p>
データフレームをCSVファイルへ書き出す
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre  class="src src-R">write.csv(x, file=<span style="color: #f1fa8c;">""</span>)
</pre>
</div></li>
<li>関数の引数
<ul>
<li><code>x</code>: 書き出すデータフレーム</li>
<li><code>file</code>: 書き出すファイルの名前<br>
(作業ディレクトリ下，またはパスを指定)</li>

</ul></li>
<li>他にも細かいオプションがあるのでヘルプを参照のこと</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgfb3317a">
<h4 id="orgfb3317a">関数 <code>read.csv()</code></h4>
<p>
CSVファイルからデータフレームを読み込む
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre  class="src src-R">read.csv(file, header=<span style="color: #61bfff;">TRUE</span>, row.names)      
</pre>
</div></li>
<li>関数の引数
<ul>
<li><code>file</code>: 読み込むファイルの名前<br>
(作業ディレクトリ下，またはパスを指定)</li>
<li><code>header</code>: 1行目を列名として使うか否か</li>
<li><code>row.names</code>: 行名の指定<br>
(行名を含む列番号/列名，または行名の直接指定が可能)</li>

</ul></li>
<li>他にも細かいオプションがあるのでヘルプを参照のこと</li>
<li>関数 <code>read.table()</code> , <code>scan()</code> なども参照</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgddea618">
<h4 id="orgddea618">例: <code>data-write/read.csv.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#38306;&#25968;write.csv&#12398;&#20351;&#12356;&#26041;</span>
(mydata <span style="color: #8be9fd;">&lt;-</span> subset(airquality, Ozone&gt;120, select=-Temp)) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#20316;&#25104;</span>
dim(mydata) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#22823;&#12365;&#12373;&#12434;&#30906;&#35469;</span>
write.csv(mydata,file=<span style="color: #f1fa8c;">"mydata.csv"</span>) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">csv&#12501;&#12449;&#12452;&#12523;&#12392;&#12375;&#12390;&#26360;&#12365;&#20986;&#12375;</span>

<span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#38306;&#25968;read.csv&#12398;&#20351;&#12356;&#26041;</span>
(newdata <span style="color: #8be9fd;">&lt;-</span> read.csv(file=<span style="color: #f1fa8c;">"mydata.csv"</span>,row.names=1)) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">csv&#12501;&#12449;&#12452;&#12523;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
dim(newdata) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#22823;&#12365;&#12373;&#12434;&#30906;&#35469;</span>
</pre>
</div>

<pre class="example">
    Ozone Solar.R Wind Month Day
62    135     269  4.1     7   1
99    122     255  4.0     8   7
117   168     238  3.4     8  25
[1] 3 5
    Ozone Solar.R Wind Month Day
62    135     269  4.1     7   1
99    122     255  4.0     8   7
117   168     238  3.4     8  25
[1] 3 5
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgeab472b">
<h3 id="orgeab472b">RData形式の操作</h3>
<div class="outline-text-3" id="text-orgeab472b">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orga25cc41">
<h4 id="orga25cc41">関数 <code>save()</code></h4>
<p>
RDataファイルへ書き出す
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre  class="src src-R">save(..., file)
</pre>
</div></li>
<li>関数の引数
<ul>
<li><code>...</code>: 保存するオブジェクト名<br>
(複数可，データフレーム以外も可)</li>
<li><code>file</code>: 書き出すファイルの名前<br>
(作業ディレクトリ下，またはパスを指定)</li>

</ul></li>
<li>CSV形式と異なり，
複数のデータフレームを1つのファイルに保存することができる</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org09ddd7d">
<h4 id="org09ddd7d">関数 <code>load()</code></h4>
<p>
RDataファイルから読み込む
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #8be9fd;">load</span>(file)
</pre>
</div></li>
<li>関数の引数
<ul>
<li><code>file</code>: 読み込むファイルの名前<br>
(作業ディレクトリ下，またはパスを指定)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org6596f15">
<h4 id="org6596f15">例: <code>data-save/load.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#38306;&#25968;save&#12398;&#20351;&#12356;&#26041;</span>
(mydat1 <span style="color: #8be9fd;">&lt;-</span> subset(airquality, Temp&gt;95, select=-Ozone)) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#20316;&#25104;</span>
(mydat2 <span style="color: #8be9fd;">&lt;-</span> subset(airquality, Temp&lt;57, select=-Ozone)) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#20316;&#25104;</span>
dim(mydat1); dim(mydat2) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#22823;&#12365;&#12373;&#12434;&#30906;&#35469;</span>
save(mydat1,mydat2,file=<span style="color: #f1fa8c;">"mydata.rdata"</span>) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">RData&#24418;&#24335;&#12391;&#26360;&#12365;&#20986;&#12375;</span>

<span style="color: #6272a4;">### </span><span style="color: #6272a4;">&#38306;&#25968;load&#12398;&#20351;&#12356;&#26041;</span>
(mydat1 <span style="color: #8be9fd;">&lt;-</span> subset(airquality, Ozone &gt; 160)) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#20316;&#25104;</span>
<span style="color: #8be9fd;">load</span>(file=<span style="color: #f1fa8c;">"mydata.rdata"</span>) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">RData&#24418;&#24335;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
mydat1; mydat2 <span style="color: #6272a4;"># </span><span style="color: #6272a4;">save&#12375;&#12383;&#12392;&#12365;&#12398;&#21517;&#21069;&#12391;&#35501;&#12415;&#36796;&#12414;&#12428;&#19978;&#26360;&#12365;&#12373;&#12428;&#12427;</span>
</pre>
</div>

<pre class="example">
    Solar.R Wind Temp Month Day
120     203  9.7   97     8  28
122     237  6.3   96     8  30
  Solar.R Wind Temp Month Day
5      NA 14.3   56     5   5
[1] 2 5
[1] 1 5
    Ozone Solar.R Wind Temp Month Day
117   168     238  3.4   81     8  25
    Solar.R Wind Temp Month Day
120     203  9.7   97     8  28
122     237  6.3   96     8  30
  Solar.R Wind Temp Month Day
5      NA 14.3   56     5   5
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb035373" data-background="#fef4f4">
<h3 id="orgb035373">演習</h3>
<ul>
<li>以下のデータを読み込み，データの操作を行ってみよう．
<ul>
<li>データファイル
<ul>
<li>jpdata1-sjis/utf8.csv: 県別の対象データ</li>
<li>jpdata2-sjis/utf8.csv: 対象データの内容</li>
<li>jpdata3-sjis/utf8.csv: 県別と地域の対応関係</li>

</ul></li>
<li><p>
<a href="https://www.e-stat.go.jp">https://www.e-stat.go.jp</a> より取得<br>
(地域から探す / 全県を選択 / 項目を選択してダウンロード)
</p>
<div class="org-src-container">

<pre  class="src src-R">mydat <span style="color: #8be9fd;">&lt;-</span> read.csv(file=<span style="color: #f1fa8c;">"jpdata1-utf8.csv"</span>,fileEncoding=<span style="color: #f1fa8c;">"utf8"</span>,row.names=1)
myval <span style="color: #8be9fd;">&lt;-</span> read.csv(file=<span style="color: #f1fa8c;">"jpdata2-utf8.csv"</span>,fileEncoding=<span style="color: #f1fa8c;">"utf8"</span>)
myreg <span style="color: #8be9fd;">&lt;-</span> read.csv(file=<span style="color: #f1fa8c;">"jpdata3-utf8.csv"</span>,fileEncoding=<span style="color: #f1fa8c;">"utf8"</span>)
</pre>
</div></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org6052333">
<h2 id="org6052333">データの集計</h2>
<div class="outline-text-2" id="text-org6052333">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org51947d0">
<h3 id="org51947d0">データの集約</h3>
<p>
データを集約するための基本的な関数は用意されている
</p>
<ul>
<li>関数 <code>sum()</code>: 総和</li>
<li>関数 <code>mean()</code>: 平均</li>
<li>関数 <code>max()</code>: 最大値</li>
<li>関数 <code>min()</code>: 最小値</li>
<li>これ以外にもベクトルの集約を行なう関数は沢山ある</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org82d0a6e">
<h4 id="org82d0a6e">例: <code>data-summary.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R">mydat <span style="color: #8be9fd;">&lt;-</span> read.csv(file=<span style="color: #f1fa8c;">"jpdata1-utf8.csv"</span>,fileEncoding=<span style="color: #f1fa8c;">"utf8"</span>,row.names=1)
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19968;&#24230;&#35501;&#12415;&#36796;&#12435;&#12391;&#12356;&#12428;&#12400;&#19978;&#12398;&#34892;&#12399;&#19981;&#35201;</span>
sum(mydat$&#20154;&#21475;) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20840;&#22269;&#12398;&#32207;&#20154;&#21475; (&#21015;&#21517;&#12391;&#36984;&#25246;)</span>
mean(mydat[,4]) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#38754;&#31309;&#12398;&#24179;&#22343;&#20516; (&#34892;&#21015;&#12392;&#12375;&#12390;&#21015;&#12434;&#36984;&#25246;)</span>
median(mydat[[4]]) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#38754;&#31309;&#12398;&#20013;&#22830;&#20516; (&#12522;&#12473;&#12488;&#12392;&#12375;&#12390;&#21015;&#12434;&#36984;&#25246;)</span>
min(mydat[<span style="color: #f1fa8c;">'&#33509;&#24180;'</span>])  <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#33509;&#24180;&#20154;&#21475;&#12398;&#26368;&#23567;&#20516; (&#21015;&#21517;&#12391;&#36984;&#25246;)</span>
with(mydat,max(&#32769;&#20154;))  <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32769;&#24180;&#20154;&#21475;&#12398;&#26368;&#22823;&#20516; (&#38306;&#25968;with&#12434;&#21033;&#29992;)</span>
</pre>
</div>

<pre class="example">
file(file, "rt", encoding = fileEncoding) でエラー: 
  コネクションを開くことができません 
追加情報:  警告メッセージ: 
file(file, "rt", encoding = fileEncoding) で: 
  ファイル 'jpdata1-utf8.csv' を開くことができません: No such file or directory

エラー:  オブジェクト 'mydat' がありません

mean(mydat[, 4]) でエラー:  オブジェクト 'mydat' がありません

median(mydat[[4]]) でエラー:  オブジェクト 'mydat' がありません

エラー:  オブジェクト 'mydat' がありません

with(mydat, max(老人)) でエラー:  オブジェクト 'mydat' がありません
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org99518d4">
<h4 id="org99518d4">関数 <code>apply()</code></h4>
<p>
列(あるいは行)ごとの計算を行う
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre  class="src src-R">apply(X, MARGIN, FUN)
</pre>
</div></li>
<li>関数の引数
<ul>
<li><code>X</code>: データフレーム</li>
<li><code>MARGIN</code>: 行(1)か列(2)かを指定</li>
<li><code>FUN</code>: 計算すべき統計量の関数</li>

</ul></li>
<li>行・列の総和や平均を計算する専用の関数が用意されている<br>
(rowSums/colSums, rowMeans/colMeans)</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org8ed0358">
<h4 id="org8ed0358">例: <code>data-apply.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R">x <span style="color: #8be9fd;">&lt;-</span> subset(mydat, select=&#23130;&#23035;:&#21220;&#22899;)
colMeans(x) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21508;&#21015;&#12398;&#24179;&#22343;</span>
apply(x, 2, max) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21015;&#12372;&#12392;&#12398;&#26368;&#22823;&#20516;</span>
sapply(x, max)   <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19978;&#12392;&#21516;&#12376;</span>
apply(x, 2, min) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21015;&#12372;&#12392;&#12398;&#26368;&#23567;&#20516;</span>
<span style="color: #6272a4;">## </span><span style="color: #6272a4;">&#33258;&#20316;&#38306;&#25968;&#12398;&#36969;&#29992;</span>
apply(x, 2, <span style="color: #ff79c6;">function</span>(x){sum(x&gt;mean(x))}) <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21015;&#12372;&#12392;&#12395;&#24179;&#22343;&#12424;&#12426;&#22823;&#12365;&#12356;&#12487;&#12540;&#12479;&#25968;&#12434;&#35336;&#31639;</span>
</pre>
</div>

<pre class="example">
subset(mydat, select = 婚姻:勤女) でエラー: 
  オブジェクト 'mydat' がありません

is.data.frame(x) でエラー:  オブジェクト 'x' がありません

apply(x, 2, max) でエラー:  オブジェクト 'x' がありません

lapply(X = X, FUN = FUN, ...) でエラー:  オブジェクト 'x' がありません

apply(x, 2, min) でエラー:  オブジェクト 'x' がありません

apply(x, 2, function(x) { でエラー:  オブジェクト 'x' がありません
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgba1de42">
<h4 id="orgba1de42">関数 <code>aggregate()</code></h4>
<p>
各行をいくつかのグループにまとめて統計量を計算する
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre  class="src src-R">aggregate(x, by, FUN)
</pre>
</div></li>
<li>関数の引数
<ul>
<li><code>x</code>: データフレーム</li>
<li><code>by</code>: 各行が属するグループを指定するベクトルをリストで与える(複数可)</li>
<li><code>FUN</code>: 求めたい統計量を計算するための関数</li>

</ul></li>
<li><code>x</code> がベクトルの場合には関数 <code>tapply()</code> も利用可能</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orga3eda0d">
<h4 id="orga3eda0d">例: <code>data-aggregate.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">## </span><span style="color: #6272a4;">&#22320;&#26041;&#12372;&#12392;&#12398;&#20154;&#21475;&#12392;&#38754;&#31309;&#12398;&#24179;&#22343;&#20516;&#12434;&#27714;&#12417;&#12427;</span>
x <span style="color: #8be9fd;">&lt;-</span> subset(mydat,select=&#20154;&#21475;:&#38754;&#31309;)
aggregate(x, by=list(&#22320;&#26041;=myreg$&#22320;&#26041;), FUN=mean) 
</pre>
</div>

<pre class="example">

subset(mydat, select = 人口:面積) でエラー: 
  オブジェクト 'mydat' がありません

aggregate(x, by = list(地方 = myreg$地方), FUN = mean) でエラー: 
  オブジェクト 'x' がありません
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orge600403">
<h4 id="orge600403">例: <code>data-aggregate.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">## </span><span style="color: #6272a4;">&#20197;&#19979;&#12398;&#12467;&#12540;&#12489;&#12418;&#21516;&#12376;&#32080;&#26524;&#12434;&#36820;&#12377;</span>
y <span style="color: #8be9fd;">&lt;-</span> data.frame(x,&#22320;&#26041;=myreg$&#22320;&#26041;) 
aggregate( . ~ &#22320;&#26041;, data=y, FUN=mean)
</pre>
</div>

<pre class="example">

data.frame(x, 地方 = myreg$地方) でエラー: 
  オブジェクト 'x' がありません

eval(m$data, parent.frame()) でエラー:  オブジェクト 'y' がありません
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgbc87edd">
<h4 id="orgbc87edd">例: <code>data-aggregate.r</code></h4>
<div class="org-src-container">

<pre  class="src src-R"><span style="color: #6272a4;">## </span><span style="color: #6272a4;">&#21508;&#22320;&#26041;&#12392;&#20154;&#21475;&#12364;&#20013;&#22830;&#20516;&#20197;&#19979;&#12363;&#21542;&#12363;&#12391;&#12464;&#12523;&#12540;&#12503;&#20998;&#12369;</span>
aggregate(x, by=list(&#22320;&#26041;=myreg$&#22320;&#26041;,
                     &#36942;&#30094;=with(mydat, &#20154;&#21475;&lt;=median(&#20154;&#21475;))),
          FUN=mean)
</pre>
</div>

<pre class="example">

aggregate(x, by = list(地方 = myreg$地方, 過疎 = with(mydat,  でエラー: 
  オブジェクト 'x' がありません
</pre>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgea73ae4" data-background="#fef4f4">
<h3 id="orgea73ae4">演習</h3>
<p>
サンプルデータの整理をしてみよう．
</p>
<ul>
<li>県別の人口密度を求めよ</li>
<li>地方別の人口密度を求めよ<br>
(県ごとに人口が異なるので単純に平均してはいけない)</li>
<li>地方別の婚姻率・離婚率を概算せよ<br>
(婚姻年齢は15歳以上として概算してよい)</li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-license" data-state="no-toc-progress">
<h2 id="license" class="no-toc-progress">License Information</h2>
<p>
Except where otherwise noted, this work,
“<span property="dc:title">データの整理と集計</span>”,
is © 2018, 2019 by
<span property="dc:creator cc:attributionName">村田 昇</span>,
published under the Creative Commons license

<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.
</p>

<blockquote>
<p>
<a href="https://creativecommons.org/licenses/by-sa/4.0/#deed-understanding">No warranties are given.  The license may not give you all of the permissions necessary for your intended use.</a>
</p>
</blockquote>

<p>
In particular, trademark rights are <i>not</i> licensed under this license.
Thus, rights concerning third party logos (e.g., on the title slide)
and other (trade-) marks (e.g., “Creative Commons” itself) remain with
their respective holders.
</p>
<div class="slide-footer"><br></div>
</section>
</section>
</div>
</div>
<script src="./reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: true,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,

overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'fade', // see README of reveal.js for options
transitionSpeed: 'default',

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/audio-slideshow/audio-slideshow.js', condition: function( ) { return !!document.body.classList && !Reveal.isSpeakerNotes(); } },
{ src: './reveal.js/plugin/anything/anything.js' },
{ src: './reveal.js/plugin/toc-progress/toc-progress.js', async: true, callback: function() { toc_progress.initialize('reduce', 'rgba(120,138,130,0.2)'); toc_progress.create(); } },
{ src: './reveal.js/plugin/jump/jump.js', async: true },
{ src: './reveal.js/plugin/quiz/js/quiz.js', async: true, callback: function() { prepareQuizzes({preventUnanswered: true, skipStartButton: true}); } },
{ src: './reveal.js/plugin/coursemod/coursemod.js', async: true },
 { src: './reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } }]

,audioStartAtFragment: true,
  audio: {
    advance: -1, autoplay: false, defaultDuration: 0, defaultAudios: false, playerOpacity: 0.8, playerStyle: 'position: fixed; bottom: 9.5vh; left: 0%; width: 30%; height:30px; z-index: 33;' },
anything: [
        // Following initialization code for class animate from anything-demo.html.
        // Copyright (c) 2016 Asvin Goel, under The MIT License (MIT).
	{className: "animate",  initialize: (function(container, options){
		Reveal.addEventListener( 'fragmentshown', function( event ) {
			if (typeof event.fragment.beginElement === "function" ) {
				event.fragment.beginElement();
			}
		});
		Reveal.addEventListener( 'fragmenthidden', function( event ) {
			if (event.fragment.hasAttribute('data-reverse') ) {
				var reverse = event.fragment.parentElement.querySelector('[id=\"' + event.fragment.getAttribute('data-reverse') + '\"]');
				if ( reverse && typeof reverse.beginElement === "function" ) {
					reverse.beginElement();
				}
			}
		});
		if ( container.getAttribute("data-svg-src") ) {
			var xhr = new XMLHttpRequest();
			xhr.onload = function() {
				if (xhr.readyState === 4) {
					var svg = container.querySelector('svg');
					container.removeChild( svg );
					container.innerHTML = xhr.responseText + container.innerHTML;
					if ( svg ) {
						container.querySelector('svg').innerHTML = container.querySelector('svg').innerHTML + svg.innerHTML;
					}
				}
				else {
					console.warn( "Failed to get file. ReadyState: " + xhr.readyState + ", Status: " + xhr.status);
				}
			};
			xhr.open( 'GET', container.getAttribute("data-svg-src"), true );
			xhr.send();
		}
	}) },
	{className: "randomPic",
	 defaults: {imgalt: "Dummy alt text",
		    imgcaption: "Image by {name}",
		    choices: [ {name: "dummyname", path: "dummypath"} ]},
	 initialize: (function(container, options){
	     var choice = Math.trunc( Math.random()*(options.choices.length) );
	     var img = "<img src='" + options.choices[choice].path + "' alt='" + options.choices[choice].imgalt + "' />";
	     var caption = options.imgcaption.replace(new RegExp('\{name\}', 'gm'), options.choices[choice].name);
	     container.innerHTML = img + caption;
	 }) },
	{className: "notes",
	 initialize: (function(container, options){
	     container.addEventListener('click', function(e) { RevealNotes.open(); });
	 }) }
],
coursemod: { enabled: true, shown: false },
});
</script>
</body>
</html>
