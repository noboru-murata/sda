#+TITLE: 記述統計量
#+SUBTITLE: 基礎的な記述統計量とデータの集約
#+AUTHOR: 村田 昇
#+EMAIL: noboru.murata@eb.waseda.ac.jp
#+DATE: 2019.06.06
:preamble:
#+INCLUDE: "./myconf.org"
#+STARTUP: hidestars content
# C-c C-x C-v でinlineを切り替え
# <l C-i でlatex block
# C-c '
#+OPTIONS: LaTeX:t    
#+PROPERTY: results output
#+PROPERTY: exports both
:end:

* 基礎的な記述統計量
** 記述統計量
   - *記述統計量* : (または要約統計量・基本統計量)
     - データを簡潔に要約して表すための統計値
     - その集団全体の特徴を表す重要な指標
     - ヒストグラム・密度関数・箱ひげ図などのグラフと併用
   - 比較的良く用いられる統計量を
     - モーメント
     - 順序
     - 頻度
     という考え方に基づいて分類する  
   - 以降，観測データは $X_1,X_2,\dots,X_n$ で表す

* モーメントに基づく　記述統計量
** 平均
   - *標本平均* (sample mean):
     \begin{equation}
       \bar{X}
       =\frac{1}{n}\sum_{i=1}^{n}X_{i}
       =\frac{X_{1}+\dotsb+X_{n}}{n}
       % =\frac{X_1+X_2+\cdots+X_n}{n}
     \end{equation}
     データの代表値を表す記述統計量
** 分散・標準偏差
   - *標本分散* (sample variance):
     \begin{equation}
       S^{2}
       =\frac{1}{n}\sum_{i=1}^n(X_{i}-\bar{X})^{2}
       =\frac{(X_{1}-\bar{X})^{2}+\dotsb+(X_{n}-\bar{X})^{2}}{n}
       % =\frac{(X_1-\bar{X})^2+(X_2-\bar{X})^2+\cdots+(X_n-\bar{X})^2}{n}
     \end{equation}
     データのばらつき具合を表す記述統計量
   - *標本標準偏差* (sample standard deviation): \\
     標本分散の平方根
** 独立同分布性
   - 統計解析における重要な仮定とその帰結:
     - 確率変数 $X_{1},X_{2},\dotsc,X_{n}$ が *同分布* \\
       共通の平均 $\mu$ および分散 $\sigma^2$ を考えることができる \\
       (適切な次数のモーメントの存在を仮定)
     - 確率変数 $X_{1},X_{2},\dotsc,X_{n}$ が *独立同分布* \\
       標本平均・標本分散・標本標準偏差は
       それぞれ $n\to\infty$ のとき確率1で
       真の平均 $\mu$ ・分散 $\sigma^2$ ・標準偏差 $\sigma$ に収束 \\
       *(大数の強法則)*
   - データは *偏っていない* ことを仮定している

** 推定量の一致性
   サンプル数が大きい場合に「まともな」推定量となる根拠の1つ
   - *(強)一致性* (consistency): \\
     推定量がサンプル数 $n\to\infty$ のとき確率1で真の値に収束する性質
   - *(強)一致推定量* : 一致性をもつ推定量
   - 標本平均・標本分散・標本標準偏差は
     平均・分散・標準偏差の一致推定量

** 推定量の不偏性
   サンプル数が小さい場合の推定量の良さに関する性質の1つ
   - *不偏性* (unbiasedness): \\
     パラメータ $\theta$ の推定量 $\hat{\theta}$
     が不偏であるとは, $\hat{\theta}$
     の平均が真の値 $\theta$ となる性質
     \begin{equation}
       \mathbb{E}[\hat{\theta}]=\theta
     \end{equation}
  - *不偏推定量* : 不偏性をもつ推定量

** 標本平均・分散の不偏性
  - 標本平均は $\mu$ の *不偏推定量である*:
    \begin{equation}
      \mathbb{E}[\bar{X}]=\mu
    \end{equation}
  - 標本分散は $\sigma^2$ の *不偏推定量ではない*:
    \begin{equation}
      \mathbb{E}[S^2]=\frac{n-1}{n}\sigma^2
    \end{equation}
    (標本分散は平均的には真の分散を *過小推定* する傾向にある)

** 不偏分散
   不偏性を担保した分散の推定量
   - バイアス補正:
     標本分散に $n/(n-1)$ を乗じたもの
     \begin{equation}
       s^2:=\frac{n}{n-1}S^2=\frac{1}{n-1}\sum_{i=1}^n(X_i-\bar{X})^2
     \end{equation}
     は $\sigma^2$ の不偏推定量となる
   - 不偏分散の計算: ~var()~
   # - わざわざ不偏性を持たない $S^2$ を $\sigma^2$ の推定量として使う理由は通常ないので,
   #   補正した $s^2$ を *標本分散* と呼ぶこともあるが，
   #   バイアス補正をしていることを強調するために通常 *不偏分散* と呼ぶ

** 標本標準偏差
   - 標本標準偏差: 通常, 不偏分散の平方根 $s$ を指す
   - 一般に $s$ は標準偏差 $\sigma$ の *不偏推定量ではない*
   - 標本標準偏差の計算: ~sd()~

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-unbiased.r~ を確認しなさい
   - 標本標準偏差が不偏推定量となるかどうかを確かめなさい
   - 気候データ (~tokyo_weather_2018~) の各項目について
     平均・分散・標準偏差を計算しなさい 

     また，ヒストグラムを描いて，
     それらの値がグラフとどのように対応するかを
     考えてみなさい

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   https://www.e-stat.go.jp
   から適当なデータをダウンロードして，
   基礎的な統計量の計算やグラフの作成を行いなさい．

   ダウンロードしたcsvファイルの先頭には，
   不要な行が含まれるが，これは以下のようにして取り除くことができる．
   #+begin_src R :exports code
     mydata <- read.csv("mydata.csv",
			fileEncoding="sjis",skip=8)      
   #+end_src

* 標準化と偏差値
** 標準化
   複数のデータを分析するために単位や基準を揃える
   - データ $X_{1},X_{2},\dotsc,X_{n}$ の標準化:
     \begin{equation}
       Z_{i}=\frac{X_i-\bar{X}}{s}\quad(i=1,2,\dotsc,n)
     \end{equation}
     ( $s$ の代わりに $S$ で割って定義する文献もある)
   - 定義から $Z_{1},Z_{2},\dotsc,Z_{n}$ の標本平均は0, 不偏分散は1 
   - $Z_{i}$: *標準得点* あるいは *Zスコア*
     # (そうなるようにデータを一次変換したものが標準化)

** 偏差値
   別の基準での標準化
   - 教育学や心理学では, 平均50, 標準偏差10が好まれる
   - 標本平均50, 標準偏差(不偏分散の平方根)10に一次変換:
     \begin{equation}
       T_{i}=10Z_{i}+50\quad(i=1,\dotsc,n)
     \end{equation}
   - $T_{i}$:
     *偏差値得点* あるいは *Tスコア* 

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-scale.r~ を確認しなさい
   - 自身のデータの各項目について
     偏差値に変換しなさい

     また，偏差値70以上のデータ，
     および偏差値40以下のデータがどのような意味を持つか
     考えなさい

* 歪度と尖度
** 歪度と尖度
   正規分布からのずれを調べるための統計量
   - 正規分布:
     - 確率分布のうち最も基本的なもの *(中心極限定理)*
     - 平均と分散を決めると完全に決定される
   - 正規分布に従うデータでは標本平均と標本分散(不偏分散)を考えれば十分
   - 現実には正規分布では捉えきれない特徴をもつデータも多い

** 歪度
   分布の非対称性を表す統計量
   - *歪度* (skewness): 
     平均 $\mu$ , 分散 $\sigma^2$ で
     3次モーメントをもつ確率変数 $X$ 
     \begin{equation}
       \text{skewness}=\frac{\mathbb{E}[(X-\mu)^3]}{\sigma^3}
     \end{equation}
   - 左右に対称的な分布の歪度は0 (正規分布の歪度は0)
     - 歪度が正の場合: 分布の右の裾の方が重い
     - 歪度が負の場合: 分布の左の裾の方が重い
   - 正の歪度をもつ分布の例:
     - ガンマ分布 $\Gamma(\nu,\alpha)$ の歪度は $2/\sqrt{\nu}$

** 尖度
   平均の周囲の分布の尖り具合を表す統計量
   - *尖度* (kurtosis):
     4次のモーメントをもつ確率変数 $X$
     \begin{equation}
       \text{kurtosis}=\frac{\mathbb{E}[(X-\mu)^4]}{\sigma^4}
     \end{equation}
   - *超過尖度* (excess kurtosis):
     正規分布との比較のため尖度から正規分布の尖度3を引いた量
     \begin{equation}
       \text{excess kurtosis}=\frac{\mathbb{E}[(X-\mu)^4]}{\sigma^4}-3
     \end{equation}
     (こちらを単に尖度と呼ぶ文献もあるので注意)

** 超過尖度
   - 正規分布と比較して
     - 超過尖度が正の場合: 平均の周囲の分布の形状が尖っている
     - 超過尖度が負の場合: 分布の形状は丸みを帯びている

       (正の場合，正規分布に比べて平均まわりの密度が
       分布の裾の方にまわっていることが多いため,
       正規分布より裾が重いと解釈されることが多い)
   - 正の超過尖度をもつ分布の例:
     - 自由度 $\nu>4$ をもつ $t$ 分布 $t(\nu)$ の超過尖度は $6/(\nu-4)$

       ($\nu\leq 4$ のときは $t(\nu)$ は4次モーメントをもたない)
     - ガンマ分布 $\Gamma(\nu,\alpha)$ の超過尖度は $6/\nu$

** 標本歪度と標本尖度
   観測データ $X_{1},X_{2},\dotsc,X_{n}$ からの歪度と尖度の推定
   - *標本歪度* (sample skewness): 
     \begin{equation}
       \text{skewness}=\frac{\frac{1}{n}\sum_{i=1}^n(X_i-\bar{X})^3}{s^3}
     \end{equation}
   - *標本尖度* (sample kurtosis):
     \begin{equation}
       \text{kurtosis}=\frac{\frac{1}{n}\sum_{i=1}^n(X_i-\bar{X})^4}{s^4}
     \end{equation}

** 歪度と尖度の計算
   - 標本歪度・標本尖度を計算する関数はRの標準機能にはない
   - ~package::e1071~ の利用例:
     - ~skewness()~: 標本歪度
     - ~kurtosis()~: 標本超過尖度 (尖度ではないので注意)
   - 自作してもよい
   - 標本歪度・標本尖度の値は標本平均・分散に比べて
     *ばらつきが大きい* ので，
     サンプル数が少ない場合の計算結果の解釈には注意が必要

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-skewkurt.r~ を確認しなさい．
   - 標本歪度のばらつきがどの程度あるか確かめなさい．
   - 標本尖度のばらつきがどの程度あるか確かめなさい．

* 相関と共分散
** 相関と共分散
   複数のデータ間の関係性を知るための記述統計量
   - *相関 (correlation)*: \\
     $x_1,x_2,\dots,x_N$ および $y_1,y_2,\dots,y_N$ に対して
     \begin{equation}
       \rho=\frac{\sum_{i=1}^N(x_i-\bar{x})(y_i-\bar{y})}
       {\sqrt{\sum_{i=1}^N(x_i-\bar{x})^2}\sqrt{\sum_{i=1}^N(y_i-\bar{y})^2}}
     \end{equation}
   - *共分散 (covariance)*:
     \begin{equation}
       \text{covariance}=\frac{\sum_{i=1}^N(x_i-\bar{x})(y_i-\bar{y})}{n-1}
     \end{equation}
     # ただし$\bar{x},\bar{y}$は
     # $x_1,x_2,\dotsc,x_N$ および $y_1,y_2,\dotsc,y_N$ の平均

** 相関と共分散
   - 直感的には2種類のデータ間の比例関係の大きさ
   - 相関の値は $-1$ 以上 $1$ 以下
     - $1$ に近いほど正の比例関係が強い
     - $-1$ に近いほど負の比例関係が強い
   - 相関・共分散の計算: ~cor()~ ・ ~cov()~
     - データ ~x~，~y~ の相関は ~cor(x,y)~ で計算
     - ~x~ がデータフレームのとき
       ~cor(x)~ は $(i,j)$ 成分が ~x~ の $i$ 列と $j$ 列の間の相関
       である *相関行列* を計算
     - 共分散についても同様

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-cor.r~ を確認しなさい
   - 気象データの相関の高い項目同士について
     散布図を描きなさい

     また，x軸を時間(月日)として
     相関の高い項目を標準化して折れ線グラフを描き比較してみなさい
   - 自身のデータについて相関や共分散を計算しなさい


* 順序に基づく統計量
** メディアン
   データの順序にもとづく記述統計量
   - *メディアン (median)* もしくは *中央値*:
     \begin{equation}
       X_{(1)}\leq X_{(2)}\leq\cdots\leq X_{(n)}
     \end{equation}
     データを昇順に並べ替えた際に中央の位置にくる値
     - $n$ が奇数の場合: $X_{((n+1)/2)}$
     - $n$ が偶数の場合: $(X_{(n/2)}+X_{(n/2+1)})/2$
   - メディアンは平均と同様にデータを代表する値
   - データ中の異常な値( *外れ値* )の影響を受けにくい
   - メディアンの計算: ~median()~ 

** 分位点
   - $100\alpha$ % *分位点 (percentile/quantile)*: メディアンの一般化

     $\alpha\in[0,1]$ に対して,
     その点以下のデータの個数が全体の約 $100\alpha$ % になるような点
     - *第1四分位点*: 25%分位点
     - *第2四分位点*: 50%分位点 (メディアンと等価)
     - *第3四分位点*: 75%分位点
   - ベクトル ~x~ の100 ~alpha~ %分位点の計算: ~quantile(x, alpha)~

     分位点は一意的には定まらず,いくつかの計算方式があるので，
     ~help(quantile)~ を参照すること

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-order.r~ を確認しなさい
   - 自身のデータのヒストグラムを描き，
     五数要約の値がグラフとどのように対応するか考えてみなさい

** 連続分布の分位点
   - 分位点は推定や検定において重要な役割を果たす
   - 連続分布の $100\alpha$ *%分位点* :
     $0<\alpha<1$ に対して，その分布に従う確率変数を $X$ としたとき，
     不等式
     \begin{equation}
       P(X\leq x)\geq\alpha
     \end{equation}
     を満たす実数 $x$ のうち最小のもの
   - そのような実数は常に存在し, それを $q_\alpha$ とすると,
     \begin{equation}
       P(X\leq q_\alpha)=\alpha
     \end{equation}
     が成り立つ

** 分位点の性質
   - $X_1,X_2,\dots,X_n$ が独立同分布な確率変数の列のとき,
     $X_1,X_2,\dots,X_n$ の $100\alpha$ %分位点は，
     $n\to\infty$ のとき $X_1,X_2,\dots,X_n$ の従う
     分布の $100\alpha$ %分位点の *一致推定量*
   - 分布の分位点の計算: \\
     ~qxxx()~ (分布の省略形が ~xxx~ )
     - 平均 ~mu~ , 標準偏差 ~sigma~ の正規分布の
       100 ~alpha~ %分位点
     #+begin_src R :exports code
       qnorm(alpha, mean=mu, sd=sigma)
     #+end_src

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-quantile.r~ を確認しなさい
   - $t$ 分布やガンマ分布の密度関数を描き，
     いくつか分位点とグラフの関係を考えてみなさい

* ばらつきの指標
** ばらつきの指標
   データのばらつきを測るための記述統計量
   - *範囲 (range)*: 最大値と最小値の差 \\
     (外れ値の影響を大きく受ける)
   - *四分位範囲 (interquantile range)*: 
     第3四分位点と第1四分位点の差
   - *メディアン絶対偏差 (median absolute deviation)*: \\
     $X_1,X_2,\dots,X_n$ のメディアンを $m$ としたとき,
     $|X_1-m|,|X_2-m|,\dots,|X_n-m|$ のメディアン

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-range.r~ を確認しなさい
   - 自身のデータのヒストグラムを描き，
     ばらつきの指標とグラフの関係を考えてみなさい

* 頻度に基づく統計量
** 頻度に基づく統計量
   - *モード (mode)* もしくは *最頻値* : データの中で最も頻度が高く現れる値
   - モードはデータが有限個の値を取る場合に特に有効
   - データが連続で無限に多くの値を取ることができる場合には
     注意が必要
     - 連続なデータの場合でも有限個の観測データに対してモードは定義できる
     - ただし，偶々観測値として現れた値なのでその意味はよく考えなくてはならない
     - 必要に応じて, 例えば区分的に集計するなどの工夫をすることもある

** 演習
   :PROPERTIES:
   :reveal_background: #fef4f4
   :END:
   - ~summary-mode.r~ を確認しなさい
   - 東京都の風のデータについて，
     風速のモードをどのように計算するのが良いか
     考えてみなさい
   - 自身のデータの適当な項目について，
     モードを求めなさい
